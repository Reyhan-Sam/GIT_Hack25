<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.min.css">
    <link rel="stylesheet" href="belle-stylesheet.css">
    <title>Results</title>
</head>

<body>
    <div id="particles-js"></div>

    <nav>
        <div class="navbar">
            <img src="https://ires.ubc.ca/files/2019/10/ubc-logo.png" alt="logo" class="nav-logo">
            <div class="nav-item">
                <i class="ri-shield-user-line"></i>
                <a href="#" onclick="goToIndexPage()">About</a>
            </div>
            <div class="nav-item">
                <i class="ri-upload-2-line"></i>
                <a href="#">How does the AI work?</a>
            </div>
            <div class=" nav-item">
                    <i class="ri-lightbulb-flash-line"></i>
                    <a href="#">Don't believe us?</a>
            </div>
            <div class="nav-item">
                <i class="ri-links-line"></i>
                <a href="#">Extension</a>
            </div>
            <a href="#" class="get-started" onclick="goToUploadPage()">Get Started</a>
        </div>
    </nav>

    <div class="folder">
        <details>
            <summary style="color:#78C1FF">Summary</summary>
            <p>Summary section
            <ul id="summary">
                <li>Key Item 1</li>
                <li>Key Item 2</li>
            </ul>
            </p>

        </details>
        <details>
            <summary style="color:red">Red Flags</summary>
            <ol id="redFlags">
                <li>Concern 1</li>
                <li>Concern 2</li>
            </ol>
        </details>
        <div class="bottom-tab"></div>
        <button class="download">Download Your Summary <i class="ri-download-line"></i></button>
    </div>
    <button onclick="fetchData()">Fetch Data</button>
    <div id="output" style="margin-top: 20px;"></div>

    <script>

        function goToIndexPage() {
            window.location.href = "index.html";
        }
        function goToUploadPage() {
            window.location.href = "upload.html";
        }

        function populateSections(data) { 
            let redFlagsList = document.getElementById("redFlags");
            redFlagsList.innerHTML = "";
            
            data.forEach(item => {
                if (item.classification === "negative") {
                    let li = document.createElement("li");
                    li.textContent = item.sentence;
                    redFlagsList.appendChild(li);
                }
            });
        }

        particlesJS("particles-js", {
            "particles": {
                "number": {
                    "value": 100,
                    "density": {
                        "enable": true,
                        "value_area": 1000
                    }
                },
                "color": {
                    "value": "#ffffff"
                },
                "shape": {
                    "type": "star"
                },
                "opacity": {
                    "value": 1,
                    "random": false
                },
                "size": {
                    "value": 3,
                    "random": true
                },
                "line_linked": {
                    "enable": true,
                    "distance": 150,
                    "color": "#ffffff",
                    "opacity": 0.7,
                    "width": 1
                },
                "move": {
                    "enable": true,
                    "speed": 3,
                    "direction": "none",
                    "random": false,
                    "straight": false,
                    "out_mode": "out"
                }
            },
            "interactivity": {
                "detect_on": "canvas",
                "events": {
                    "onhover": {
                        "enable": true,
                        "mode": "grab"
                    },
                    "onclick": {
                        "enable": true,
                        "mode": "push"
                    }
                },
                "modes": {
                    "grab": {
                        "distance": 200,
                        "line_linked": {
                            "opacity": 1
                        }
                    },
                    "push": {
                        "particles_nb": 4
                    }
                }
            },
            "retina_detect": true
        });
    </script>

    <script>
        async function fetchData() {
            try {
                const response = await fetch('http://127.0.0.1:5000/text-analyze', {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        text: "We have appropriate organizational safeguards and security measures in place to protect your Personal Data from being accidentally lost, used or accessed in an unauthorized way, altered or disclosed. The communication between your browser and our website uses a secure encrypted connection wherever your Personal Data is involved. We require any third party who is contracted to process your Personal Data on our behalf to have security measures in place to protect your data and to treat such data in accordance with the law. In the unfortunate event of a Personal Data breach, we will notify you and any applicable regulator when we are legally required to do so. Personal information may be stored on unsecured servers. Personal information may be stored on unsecured servers lol." 

                    })
                });
        
                const data = await response.json();
        
                // Select Red Flags section and clear existing content
                let redFlagsList = document.getElementById("redFlags");
                redFlagsList.innerHTML = ""; 
        
                // Iterate through all negative classifications and add them
                let negativeSentences = data.filter(item => item.classification === "negative");
        
                if (negativeSentences.length > 0) {
                    negativeSentences.forEach(item => {
                        let li = document.createElement("li");
                        li.textContent = item.sentence.trim(); // Trim to remove unnecessary spaces
                        redFlagsList.appendChild(li);
                    });
                } else {
                    // If no red flags, show a default message
                    let li = document.createElement("li");
                    li.textContent = "No red flags detected.";
                    redFlagsList.appendChild(li);
                }
        
            } catch (error) {
                console.error("Error fetching data:", error);
                document.getElementById('output').innerHTML = `<p style="color:red;">Error fetching data</p>`;
            }
        }
    </script>

</body>

</html>