<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Switzer:wght@100;300;400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.min.css">
    <link rel="stylesheet" href="belle-stylesheet.css">
    <title>Results</title>
</head>

<body>
    <div id="particles-js"></div>

    <nav>
        <div class="navbar">
            <img src="https://ires.ubc.ca/files/2019/10/ubc-logo.png" alt="logo" class="nav-logo">
            <div class="nav-item">
                <i class="ri-shield-user-line"></i>
                <a href="#" onclick="goToIndexPage()">About</a>
            </div>
            <div class="nav-item">
                <i class="ri-upload-2-line"></i>
                <a href="#">How does the AI work?</a>
            </div>
            <div class=" nav-item">
                <i class="ri-lightbulb-flash-line"></i>
                <a href="#">Don't believe us?</a>
            </div>
            <div class="nav-item">
                <i class="ri-links-line"></i>
                <a href="#">Extension</a>
            </div>
            <a href="#" class="get-started" onclick="goToUploadPage()">Get Started</a>
        </div>
    </nav>

    <div class="folder">
        <details>
            <summary style="color:#78C1FF">Summary</summary>
            <p>Summary section
            <ul id="summary">
                <li>Key Item 1</li>
                <li>Key Item 2</li>
            </ul>
            </p>

        </details>
        <details>
            <summary style="color:red">Red Flags</summary>
            <ol id="redFlags">
                <li>Concern 1</li>
                <li>Concern 2</li>
            </ol>
        </details>
        <div class="bottom-tab"></div>
        <button class="download">Download Your Summary <i class="ri-download-line"></i></button>
    </div>
    <button onclick=" fetchSummary(); fetchData();">Analyze Document</button>
    <div id="output" style="margin-top: 20px;"></div>

    <script src="index.js"></script>
    <script>

        function goToIndexPage() {
            window.location.href = "index.html";
        }
        function goToUploadPage() {
            window.location.href = "upload.html";
        }

        function populateSections(data) {
            let redFlagsList = document.getElementById("redFlags");
            redFlagsList.innerHTML = "";

            data.forEach(item => {
                if (item.classification === "negative") {
                    let li = document.createElement("li");
                    li.textContent = item.sentence;
                    redFlagsList.appendChild(li);
                }
            });
        }

        particlesJS("particles-js", {
            "particles": {
                "number": {
                    "value": 100,
                    "density": {
                        "enable": true,
                        "value_area": 1000
                    }
                },
                "color": {
                    "value": "#ffffff"
                },
                "shape": {
                    "type": "star"
                },
                "opacity": {
                    "value": 1,
                    "random": false
                },
                "size": {
                    "value": 3,
                    "random": true
                },
                "line_linked": {
                    "enable": true,
                    "distance": 150,
                    "color": "#ffffff",
                    "opacity": 0.7,
                    "width": 1
                },
                "move": {
                    "enable": true,
                    "speed": 3,
                    "direction": "none",
                    "random": false,
                    "straight": false,
                    "out_mode": "out"
                }
            },
            "interactivity": {
                "detect_on": "canvas",
                "events": {
                    "onhover": {
                        "enable": true,
                        "mode": "grab"
                    },
                    "onclick": {
                        "enable": true,
                        "mode": "push"
                    }
                },
                "modes": {
                    "grab": {
                        "distance": 200,
                        "line_linked": {
                            "opacity": 1
                        }
                    },
                    "push": {
                        "particles_nb": 4
                    }
                }
            },
            "retina_detect": true
        });
    </script>

    <script>
        async function fetchSummary() {
            try {
                const response = await fetch('http://127.0.0.1:5000/summarize-text', {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: "We have appropriate organizational safeguards and security measures in place to protect your Personal Data from being accidentally lost, used or accessed in an unauthorized way, altered or disclosed. The communication between your browser and our website uses a secure encrypted connection wherever your Personal Data is involved. We require any third party who is contracted to process your Personal Data on our behalf to have security measures in place to protect your data and to treat such data in accordance with the law. In the unfortunate event of a Personal Data breach, we will notify you and any applicable regulator when we are legally required to do so. Personal information may be stored on unsecured servers."
                    })
                });

                const data = await response.json();
                console.log(data);  // Debugging: Check response format

                let summaryContainer = document.getElementById("summary");
                summaryContainer.innerHTML = ""; // Clear previous content

                if (data.summary) {
                    let formattedSummary = formatLLMResponse(data.summary);
                    summaryContainer.innerHTML = formattedSummary;
                } else {
                    summaryContainer.innerHTML = "<p>No summary generated.</p>";
                }

            } catch (error) {
                console.error("Error fetching summary:", error);
                document.getElementById('summary').innerHTML = `<p style="color:red;">Error fetching summary</p>`;
            }
        }

        async function fetchData() {
            try {
                const response = await fetch('http://127.0.0.1:5000/text-analyze', {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: "If you provide or make available any personal data to Snap or its affiliates, including by enabling Snap to receive personal data through Snap tools like pixels, JavaScript SDKs, APIs or cookies, within content you approve or make available via the Business Services, or by providing personal data to a third party for the purposes of using the Business Services, then in addition to the representations and warranties in the Business Services Terms, you represent and warrant that: (a) you will comply with Applicable Law, applicable self-regulatory standards and guidelines and any applicable mobile developer or app store terms, guidelines or policies (collectively, Rules) when using the Business Services; (b) the personal data will not contain any information collected from an online service directed to children or about individuals that are under the age of 13 (or, if greater than the age of 13, the minimum age at which the processing of personal data of a data subject is lawful under Applicable Law) or any sensitive information or special category data, as defined in the Rules, including any information that is based on, or includes: (i) an alleged or actual commission of a crime; (ii) health information, including any health information further detailed in our Business Help Centre; or (iii) information about user's financial status, racial or ethnic origin, religious beliefs or preferences, sex life or sexual preferences or trade union membership; (c) the personal data will not contain, include, be based on, or otherwise reveal (directly or indirectly) any “protected health information” or “consumer health data” (as defined in the Rules); (d) you have secured, and will maintain, all necessary rights, licences and consents required to provide or make available the personal data and for the personal data to be used in accordance with the Business Services Terms, including from all data subjects whose data is included in personal data; (d) you will provide sufficient notice to each data subject in compliance with the Rules that the data subject's information collected by you or your agents may be shared with and used by third parties for the purposes specified under the Business Services Terms, including, at a minimum a clear and prominent notice about how and where users can opt out of the use of personal data for ad targeting and, where applicable: (i) for websites, a clear and prominent notice on each webpage where you utilise the Business Services stating that third parties, including Snap and its affiliates, may use cookies, web beacons and other technologies to collect or receive information from your websites, apps and elsewhere on the internet, and may use that information to provide measurement services, advertising targeting and other advertising services; and (ii) for apps, a clear and prominent link inside your apps' settings or your privacy policy, and from within any store or website where your apps are distributed, that explains that third parties, including Snap and its affiliates, may collect or receive information from your apps and other apps, and may use that information to provide measurement services, ad targeting, and other advertising services; (e) in jurisdictions that require informed consent for storing and accessing cookies or other information of a Data Subject (including the European Union), you must ensure, in a verifiable manner, that each data subject provides you with the necessary consent before you use the Business Services to send personal data in connection with that data subject; and (f) you will promptly notify Snap of any actual or threatened complaint relating to personal data, and you will reasonably cooperate with Snap, at your expense, in responding or defending against any such complaint. Snap may request further information in connection with your compliance with this Section."

                    })
                });

                const data = await response.json();

                // Select Red Flags section and clear existing content
                let redFlagsList = document.getElementById("redFlags");
                redFlagsList.innerHTML = "";

                // Iterate through all negative classifications and add them
                let negativeSentences = data.filter(item => item.classification === "negative");

                if (negativeSentences.length > 0) {
                    negativeSentences.forEach(item => {
                        let li = document.createElement("li");
                        li.textContent = item.sentence.trim(); // Trim to remove unnecessary spaces
                        redFlagsList.appendChild(li);
                    });
                } else {
                    // If no red flags, show a default message
                    let li = document.createElement("li");
                    li.textContent = "No red flags detected.";
                    redFlagsList.appendChild(li);
                }

            } catch (error) {
                console.error("Error fetching data:", error);
                document.getElementById('output').innerHTML = `<p style="color:red;">Error fetching data</p>`;
            }
        }
        function formatLLMResponse(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")  // Convert **bold** to <strong>
                .replace(/\*(.*?)\*/g, "<em>$1</em>")  // Convert *italic* to <em>
                .replace(/\n\s*[-*]\s*(.*?)(?=\n|$)/g, "<li>$1</li>") // Convert bullet points
                .replace(/\n{2,}/g, "</p><p>") // Convert double new lines to paragraphs
                .replace(/\n/g, "<br>"); // Convert single new lines to line breaks
        }
    </script>

</body>

</html>